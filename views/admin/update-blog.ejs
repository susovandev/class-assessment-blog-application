<!DOCTYPE html>
<html lang="en">
<%- include("../partials/head.ejs", {title: "Edit Blog"}) %>

<body class="bg-gray-100 min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-gray-900 text-gray-100 flex flex-col">

    <div class="px-6 py-5 text-2xl font-bold border-b border-gray-800">
      Admin Panel
    </div>

    <nav class="flex-1 px-4 py-6 space-y-2">
      <a href="/admin/dashboard" class="block px-4 py-2 rounded hover:bg-gray-800">
        Dashboard
      </a>
      <a href="/admin/categories" class="block px-4 py-2 rounded hover:bg-gray-800">
        Manage Categories
      </a>
      <a href="/admin/blogs" class="block px-4 py-2 rounded bg-gray-800">
        Manage Blogs
      </a>
      <a href="/admin/users" class="block px-4 py-2 rounded hover:bg-gray-800">
        Manage Users
      </a>
      <a href="/admin/comments" class="block px-4 py-2 rounded hover:bg-gray-800">
        Manage Comments
      </a>
    </nav>

    <div class="px-4 py-4 border-t border-gray-800 text-sm text-gray-400">
      Logged in as <span class="text-white font-medium"><%= admin?.username || '' %></span>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 px-20 py-8">

    <!-- Toast Flash -->
    <%- include('../partials/toast') %>

    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-800">Edit Blog</h1>
      <p class="text-gray-600 mt-1">
        Update blog details
      </p>
    </div>

    <!-- Edit Blog Form -->
    <form
      action="/admin/blogs/<%= blog._id %>/edit?_method=PUT"
      method="POST"
      enctype="multipart/form-data"
      class="bg-white rounded-xl shadow p-8 space-y-6 max-w-4xl"
    >

      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Blog Title
        </label>
        <input
          type="text"
          name="title"
          required
          value="<%= blog?.title %>"
          class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- Content -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Content
        </label>
        <textarea
          name="content"
          rows="8"
          required
          class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
        ><%= blog?.content %></textarea>
      </div>

      <!-- Current Image -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Current Image
        </label>
        <img
          src="<%= blog?.image?.secure_url %>"
          alt="Blog Image"
          class="w-48 h-32 object-cover rounded border"
        />
      </div>

      <!-- Replace Image -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Replace Image (optional)
        </label>
        <input
          type="file"
          name="image"
          accept="image/*"
          class="w-full border rounded-md p-2"
        />
      </div>

      <!-- Category -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Category
        </label>
        <select
          name="categoryId"
          required
          class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
        >
          <% categories.forEach(category => { %>
            <option
              value="<%= category._id %>"
              <%= String(category._id) === String(blog.categoryId) ? 'selected' : '' %>
            >
              <%= category.name %>
            </option>
          <% }) %>
        </select>
      </div>

      <!-- Tags -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Tags
        </label>
        <input
          type="text"
          name="tags"
          value="<%= blog.tags.join(', ') %>"
          placeholder="e.g. nodejs, express"
          class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- Actions -->
      <div class="flex justify-end gap-4 pt-4">

        <a
          href="/admin/blogs"
          class="px-6 py-2 rounded-md bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium"
        >
          Cancel
        </a>

        <button
          type="submit"
          class="px-6 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold"
        >
          Update Blog
        </button>

      </div>

    </form>

  </main>

</body>
</html>
