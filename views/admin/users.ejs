<!DOCTYPE html>
<html lang="en">
  <%- include("../partials/head.ejs", {title: "User Management"}) %>

  <body class="bg-gray-100 min-h-screen flex">
    <!-- Sidebar -->
    <%- include("../admin/sidebar.ejs", {username: admin.username, profileImage: admin.profileImage?.secure_url ?? `https://ui-avatars.com/api/?name=${admin.username}`}) %>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <!-- Toast Flash -->
      <%- include('../partials/toast') %>

      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <div>
          <h1 class="text-3xl font-bold text-gray-800">User Management</h1>
          <p class="text-gray-600 mt-1">
            Total Users: <span class="font-semibold"><%= users.length %></span>
          </p>
        </div>
      </div>

      <!-- Users Table -->
      <div class="bg-white rounded-xl shadow overflow-x-auto">
        <table class="min-w-full border-collapse">
          <thead class="bg-gray-100">
            <tr>
              <th
                class="px-6 py-3 text-left text-sm font-semibold text-gray-600"
              >
                Profile
              </th>
              <th
                class="px-6 py-3 text-left text-sm font-semibold text-gray-600"
              >
                Username
              </th>
              <th
                class="px-6 py-3 text-left text-sm font-semibold text-gray-600"
              >
                Email
              </th>
              <th
                class="px-6 py-3 text-left text-sm font-semibold text-gray-600"
              >
                Role
              </th>
              <th
                class="px-6 py-3 text-left text-sm font-semibold text-gray-600"
              >
                Status
              </th>
              <th
                class="px-6 py-3 text-center text-sm font-semibold text-gray-600"
              >
                Action
              </th>
            </tr>
          </thead>

          <tbody>
            <% users.forEach(user => { %>
            <tr class="border-t">
              <!-- Profile -->
              <td class="px-6 py-4">
                <img
                  src="<%= user.profileImage.secure_url %>"
                  class="w-10 h-10 rounded-full object-cover border"
                />
              </td>

              <!-- Username -->
              <td class="px-6 py-4 font-medium text-gray-800">
                <%= user.username %>
              </td>

              <!-- Email -->
              <td class="px-6 py-4 text-gray-600"><%= user.email %></td>

              <!-- Role -->
              <td class="px-6 py-4">
                <span
                  class="px-3 py-1 text-xs rounded-full font-semibold <%= user.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700' %>"
                >
                  <%= user.role.toUpperCase() %>
                </span>
              </td>

              <!-- Status -->
              <td class="px-6 py-4">
                <span
                  class="px-3 py-1 text-xs rounded-full font-semibold <%= user.isActive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700' %>"
                >
                  <%= user.isActive ? 'Active' : 'Disabled' %>
                </span>
              </td>

              <!-- Action -->
              <td class="px-6 py-4 text-center">
                <% if (user.role === 'admin') { %>
                <span class="text-gray-400 text-sm"> Protected </span>
                <% } else { %>
                <form
                  action="/admin/users/<%= user._id %>/toggle"
                  method="POST"
                  class="inline"
                >
                  <button
                    type="submit"
                    class="px-4 py-1 text-sm rounded-md font-medium <%= user.isActive ? 'bg-red-600 hover:bg-red-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white' %>"
                  >
                    <%= user.isActive ? 'Disable' : 'Enable' %>
                  </button>
                </form>
                <% } %>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </main>
  </body>
</html>
