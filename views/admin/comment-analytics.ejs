<!DOCTYPE html>
<html lang="en">
<%- include("../partials/head.ejs", {title: "Comment Analytics"}) %>

<body class="bg-gray-100 min-h-screen flex">

  <!-- Sidebar -->
<aside class="w-64 bg-gray-900 text-gray-100 flex flex-col min-h-screen">

  <!-- Logo / Title -->
  <div class="px-6 py-5 text-2xl font-bold border-b border-gray-800">
    Admin Panel
  </div>

  <!-- Navigation -->
  <nav class="flex-1 px-4 py-6 space-y-2">

    <a href="/admin/dashboard"
       class="block px-4 py-2 rounded hover:bg-gray-800">
      Dashboard
    </a>

    <a href="/admin/categories"
       class="block px-4 py-2 rounded hover:bg-gray-800">
      Manage Categories
    </a>

    <a href="/admin/blogs"
       class="block px-4 py-2 rounded hover:bg-gray-800">
      Manage Blogs
    </a>

    <a href="/admin/users"
       class="block px-4 py-2 rounded hover:bg-gray-800">
      Manage Users
    </a>

    <a href="/admin/comments"
       class="block px-4 py-2 rounded hover:bg-gray-800">
      Comment Analytics
    </a>

  </nav>

  <div class="border-t border-gray-800 px-4 py-4 flex items-center justify-between">

    <!-- Admin Info -->
    <div class="flex items-center gap-3">
      <img
        src="<%= admin.profileImage?.secure_url || 'https://ui-avatars.com/api/?name=' + admin.username %>"
        alt="Admin Avatar"
        class="w-10 h-10 rounded-full object-cover border border-gray-700"
      />

      <div>
        <p class="text-sm font-semibold text-white">
          <%= admin.username %>
        </p>
        <p class="text-xs text-gray-400">
          Administrator
        </p>
      </div>
    </div>

    <!-- Logout -->
    <form action="/auth/logout" method="POST">
      <button
        type="submit"
        title="Logout"
        class="text-red-400 hover:text-red-500 transition"
      >
        âŽ‹
      </button>
    </form>

  </div>

</aside>


  <!-- Main Content -->
  <main class="flex-1 p-8">

    <!-- Flash Toast -->
    <%- include('../partials/toast') %>

    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800">Comment Analytics</h1>
      <p class="text-gray-600 mt-1">
        Blog-wise comment insights and engagement
      </p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">

      <div class="bg-white p-6 rounded-xl shadow">
        <p class="text-sm text-gray-500">Total Comments</p>
        <p class="text-3xl font-bold text-gray-800 mt-2">
          <%= stats.totalComments %>
        </p>
      </div>

      <div class="bg-white p-6 rounded-xl shadow">
        <p class="text-sm text-gray-500">Active Comments</p>
        <p class="text-3xl font-bold text-green-600 mt-2">
          <%= stats.activeComments %>
        </p>
      </div>

      <div class="bg-white p-6 rounded-xl shadow">
        <p class="text-sm text-gray-500">Hidden Comments</p>
        <p class="text-3xl font-bold text-red-600 mt-2">
          <%= stats.hiddenComments %>
        </p>
      </div>

      <div class="bg-white p-6 rounded-xl shadow">
        <p class="text-sm text-gray-500">Most Commented Blog</p>
        <p class="text-lg font-semibold text-gray-800 mt-2">
          <%= stats.topBlog ? stats.topBlog.title : 'N/A' %>
        </p>
      </div>

    </div>

    <!-- Blog Comment Breakdown -->
    <div class="bg-white rounded-xl shadow mb-10">

      <div class="px-6 py-4 border-b">
        <h2 class="text-xl font-semibold text-gray-800">
          Comments Per Blog
        </h2>
      </div>

      <table class="min-w-full">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600">
              Blog Title
            </th>
            <th class="px-6 py-3 text-center text-sm font-semibold text-gray-600">
              Total
            </th>
            <th class="px-6 py-3 text-center text-sm font-semibold text-gray-600">
              Active
            </th>
            <th class="px-6 py-3 text-center text-sm font-semibold text-gray-600">
              Hidden
            </th>
          </tr>
        </thead>

        <tbody>
          <% blogStats.forEach(blog => { %>
            <tr class="border-t hover:bg-gray-50">
              <td class="px-6 py-4 font-medium text-gray-800">
                <%= blog.title %>
              </td>
              <td class="px-6 py-4 text-center">
                <%= blog.totalComments %>
              </td>
              <td class="px-6 py-4 text-center text-green-600 font-medium">
                <%= blog.activeComments %>
              </td>
              <td class="px-6 py-4 text-center text-red-600 font-medium">
                <%= blog.hiddenComments %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

    </div>

    <!-- Recent Comments -->
    <div class="bg-white rounded-xl shadow">

      <div class="px-6 py-4 border-b">
        <h2 class="text-xl font-semibold text-gray-800">
          Recent Comments
        </h2>
      </div>

      <table class="min-w-full">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600">
              User
            </th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600">
              Comment
            </th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600">
              Blog
            </th>
            <th class="px-6 py-3 text-center text-sm font-semibold text-gray-600">
              Status
            </th>
            <th class="px-6 py-3 text-center text-sm font-semibold text-gray-600">
              Date
            </th>
          </tr>
        </thead>

        <tbody>
          <% recentComments.forEach(comment => { %>
            <tr class="border-t hover:bg-gray-50">

              <td class="px-6 py-4 font-medium">
                <%= comment.userId?.username || 'Unknown' %>
              </td>

              <td class="px-6 py-4 text-gray-600 max-w-xs truncate">
                <%= comment.content %>
              </td>

              <td class="px-6 py-4">
                <%= comment.blogId?.title || 'Deleted Blog' %>
              </td>

              <td class="px-6 py-4 text-center">
                <span class="px-3 py-1 text-xs rounded-full font-semibold
                  <%= comment.isActive
                    ? 'bg-green-100 text-green-700'
                    : 'bg-red-100 text-red-700' %>">
                  <%= comment.isActive ? 'Active' : 'Hidden' %>
                </span>
              </td>

              <td class="px-6 py-4 text-center text-sm text-gray-500">
                <%= new Date(comment.createdAt).toLocaleDateString() %>
              </td>

            </tr>
          <% }) %>
        </tbody>
      </table>

    </div>

  </main>

</body>
</html>
