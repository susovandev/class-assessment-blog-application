<!DOCTYPE html>
<html lang="en">
<%- include("../partials/head.ejs", {title: "Manage Blogs"}) %>

<body class="bg-gray-100 min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-gray-900 text-gray-100 flex flex-col">

    <div class="px-6 py-5 text-2xl font-bold border-b border-gray-800">
      Admin Panel
    </div>

    <nav class="flex-1 px-4 py-6 space-y-2">
      <a href="/admin/dashboard" class="block px-4 py-2 rounded hover:bg-gray-800">
        Dashboard
      </a>
      <a href="/admin/categories" class="block px-4 py-2 rounded hover:bg-gray-800">
        Manage Categories
      </a>
      <a href="/admin/blogs" class="block px-4 py-2 rounded bg-gray-800">
        Manage Blogs
      </a>
      <a href="/admin/users" class="block px-4 py-2 rounded hover:bg-gray-800">
        Manage Users
      </a>
      <a href="/admin/comments" class="block px-4 py-2 rounded hover:bg-gray-800">
        Manage Comments
      </a>
    </nav>

    <div class="px-4 py-4 border-t border-gray-800 text-sm text-gray-400">
      Logged in as <span class="text-white font-medium"><%= admin?.username %></span>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8">

    <!-- Toast Flash -->
    <%- include('../partials/toast') %>

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-3xl font-bold text-gray-800">Blog Management</h1>

      <a
        href="/admin/blogs/add"
        class="px-6 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold"
      >
        âž• Add Blog
      </a>
    </div>

    <!-- Blog Table -->
    <div class="bg-white rounded-xl shadow p-6">

      <% if (blogs && blogs.length === 0) { %>
        <p class="text-gray-500 text-sm">No blogs found.</p>
      <% } else { %>

      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 border text-center">Image</th>
              <th class="px-4 py-2 border text-center">Title</th>
              <th class="px-4 py-2 border text-center">Category</th>
              <th class="px-4 py-2 border text-center">Comments</th>
              <th class="px-4 py-2 border text-center">Created At</th>
              <th class="px-4 py-2 border text-center">Actions</th>
            </tr>
          </thead>

          <tbody>
            <% blogs.forEach(blog => { %>
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-2 border">
                  <img
                    src="<%= blog?.image?.secure_url %>"
                    alt="<%= blog?.title %>"
                    class="w-12 h-12 object-cover rounded-full"
                  />
                </td>
                <td class="px-4 py-2 border font-medium">
                  <%= blog?.title %>
                </td>

                <td class="px-4 py-2 border text-sm text-gray-600">
                  <%= blog?.category?.name || 'N/A' %>
                </td>

                <td class="px-4 py-2 border text-center font-semibold">
                  <%= blog?.totalComments %>
                </td>

                <td class="px-4 py-2 border text-sm text-gray-600">
                  <%= new Date(blog?.createdAt).toLocaleDateString() %>
                </td>

                <td class="px-4 py-2 border text-center space-x-2">

                  <a
                    href="/admin/blogs/<%= blog?._id %>/edit"
                    class="px-3 py-1 rounded bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-semibold"
                  >
                    Edit
                  </a>

                  <form
                    action="/admin/blogs/<%= blog?._id %>?_method=DELETE"
                    method="POST"
                    class="inline"
                    onsubmit="return confirm('Are you sure you want to delete this blog?')"
                  >
                    <button
                      type="submit"
                      class="px-3 py-1 rounded bg-red-600 hover:bg-red-700 text-white text-sm font-semibold"
                    >
                      Delete
                    </button>
                  </form>

                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <% } %>
    </div>

  </main>

</body>
</html>
